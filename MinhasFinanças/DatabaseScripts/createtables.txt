CREATE TABLE USERS (
    CDUSER INT AUTO_INCREMENT PRIMARY KEY,
    FULLNAME VARCHAR(150) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    PASSWORD VARCHAR(255) NOT NULL,
    BALANCE DECIMAL(15, 2) DEFAULT 0.00,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE PAYMENTTYPE (
    CDPAYMENTTYPE INT AUTO_INCREMENT PRIMARY KEY,
    CDUSER INT NOT NULL,
    PAYMENTTYPENAME VARCHAR(100) NOT NULL,
    CARDTYPE ENUM('CREDIT', 'DEBIT'),
    LIMITVALUE DECIMAL(15, 2) DEFAULT NULL,
    DTEXPIRED TIMESTAMP NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CDUSER) REFERENCES USERS(CDUSER) ON DELETE CASCADE
);

CREATE TABLE EXPENSETYPE (
    CDEXPENSETYPE INT AUTO_INCREMENT PRIMARY KEY,
    CDUSER INT NOT NULL,
    TYPENAME VARCHAR(100) NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CDUSER) REFERENCES USERS(CDUSER) ON DELETE CASCADE
);

CREATE TABLE INCOMETYPE (
    CDINCOMETYPE INT AUTO_INCREMENT PRIMARY KEY,
    CDUSER INT NOT NULL,
    TYPENAME VARCHAR(100) NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CDUSER) REFERENCES USERS(CDUSER) ON DELETE CASCADE
);

CREATE TABLE TRANSACTIONTYPE (
    CDTYPE INT AUTO_INCREMENT PRIMARY KEY,
    NMTYPE VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE TRANSACTION (
    CDTRANSACTION INT AUTO_INCREMENT PRIMARY KEY,
    CDUSER INT NOT NULL,
    CDPAYMENTTYPE INT DEFAULT NULL,
    AMOUNT DECIMAL(15, 2) NOT NULL,
    TRANSACTIONTYPE VARCHAR(50) NOT NULL,
    DESCRIPTION TEXT DEFAULT NULL,
    DTTRANSACTION DATE NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CDUSER) REFERENCES USERS(CDUSER) ON DELETE CASCADE,
    FOREIGN KEY (CDPAYMENTTYPE) REFERENCES PAYMENTTYPE(CDPAYMENTTYPE) ON DELETE SET NULL,
    FOREIGN KEY (TRANSACTIONTYPE) REFERENCES TRANSACTIONTYPE(NMTYPE) ON DELETE CASCADE
);

CREATE TABLE BUDGET (
    CDBUDGET INT AUTO_INCREMENT PRIMARY KEY,
    BUDGETAMOUNT DECIMAL(15, 2) NOT NULL,
    DTSTARTED DATE NOT NULL,
    DTFINISHED DATE NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE GOALS (
    CDGOAL INT AUTO_INCREMENT PRIMARY KEY,
    CDBUDGET INT NOT NULL,
    GOALNAME VARCHAR(150) NOT NULL,
    CDPLAN INT,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CDBUDGET) REFERENCES BUDGET(CDBUDGET) ON DELETE CASCADE
);

CREATE TABLE GOALPLAN (
    CDPLAN INT AUTO_INCREMENT PRIMARY KEY,
    CDGOAL INT NOT NULL,
    DESCPLAN TEXT NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DTFINISHED DATE,
    CURRENTAMOUNT DECIMAL(15, 2) NOT NULL,
    EXPENSEAMOUNT DECIMAL(15, 2),
    FOREIGN KEY (CDGOAL) REFERENCES GOALS(CDGOAL) ON DELETE CASCADE
);

CREATE TABLE INCOME (
    CDINCOME INT NOT NULL PRIMARY KEY,
    INCOMENAME VARCHAR(100) NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AMOUNT DECIMAL(15 , 2 ) NOT NULL,
    CDUSER INT NOT NULL,
    CDTRANSACTION INT NOT NULL,
    INCOMETYPE INT NOT NULL,
    FOREIGN KEY (CDUSER)
        REFERENCES USERS (CDUSER)
        ON DELETE CASCADE,
    FOREIGN KEY (INCOMETYPE)
        REFERENCES INCOMETYPE (CDINCOMETYPE)
        ON DELETE CASCADE,
    FOREIGN KEY (CDTRANSACTION)
        REFERENCES TRANSACTION (CDTRANSACTION)
        ON DELETE CASCADE
);

CREATE TABLE EXPENSE (
    CDEXPENSE INT NOT NULL PRIMARY KEY,
    EXPENSENAME VARCHAR(100) NOT NULL,
    DTCREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AMOUNT DECIMAL(15, 2) NOT NULL,
    CDUSER INT NOT NULL,
    CDTRANSACTION INT NOT NULL,
    EXPENSETYPE INT NOT NULL,
    FOREIGN KEY (CDUSER) REFERENCES USERS(CDUSER) ON DELETE CASCADE,
    FOREIGN KEY (EXPENSETYPE) REFERENCES EXPENSETYPE(CDEXPENSETYPE) ON DELETE CASCADE,
    FOREIGN KEY (CDTRANSACTION) REFERENCES TRANSACTION(CDTRANSACTION) ON DELETE CASCADE
);
